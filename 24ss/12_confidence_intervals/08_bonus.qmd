# [Bonuscontent]{color="darkred"}

## [Konfidenzintervalle für Regressionskoeffizienten]{color="darkred"}{#reg}

Im Gegensatz zu Korrelationskoeffizienten sind Regressionskoeffizienten $\hat{b}_1$ nicht auf das Intervall $[0; 1]$ beschränkt. Das Konfidenzintervall kann daher wie beim Mittelwert berechnet werden:

$$
CI=\hat{b}_1\pm t_{(1-\frac{\alpha}{2},\,\text{df})}\cdot\hat{se}
$$


mit:

$$
\hat{se}(\hat{b}_1)= \frac{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{Y}}}{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{X}}}\sqrt{\frac{1-\hat{\rho}^2}{n-2}}
$$


Da für $\hat{se}(\hat{b}_1)$ genau 2 Mittelwerte berechnet werden müssen ($\bar{x}$ in $\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{X}}$ und $\bar{y}$ in $\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{Y}}$), ist die t-Prüfgröße der Regressionssteigung mit $\text{df}=n-2$ Freiheitsgraden verbunden, und damit:

<div class="vspace-medium"></div>

::: {.colorbox}
$$
\text{Konfidenzintervall Regression:}\qquad CI=\hat{b}_1\pm t_{(1-\frac{\alpha}{2},\,n-2)}\cdot\hat{se}
$$

:::



<!----------------->
<!--- New slide --->
<!----------------->
## [Konfidenzintervalle für Regressionskoeffizienten]{color="darkred"}

:::{.nonincremental}
- Moderne Statistikprogramme können die Unsicherheit die mit der Steigung der einfachen Regression verbunden ist, auch graphisch zum Ausdruck bringen.
- Um das illustrieren, verwenden wir erneut den Beispielzusammenhang Größe-Gewicht ($\hat{\rho}=0.4$).
- Wir nehmen als Standardabweichungen an $\hat{\sigma}_\text{Größe} = 16.5$ und $\hat{\sigma}_\text{Gewicht} = 6.8$. Damit ergibt sich die Steigung $\hat{b}_1$ und der zugehörige Standardfehler:
:::

:::{style="margin-top: -15px"}
$$
\hat{b}_1 = \frac{\hat{\sigma}_\text{Gewicht}}{\hat{\sigma}_\text{Größe}}\cdot \hat{\rho} = \frac{6.8}{16.5}\cdot 0.4 = 0.16\qquad\Big(\text{Reminder:}\;\hat{b}_1=\frac{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{Y}}}{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{X}}}\hat{\rho}\Big)
$$
:::

$$
\hat{se}(\hat{b}_1)= \frac{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{Y}}}{\hat{\sigma}_{\mkern-2mu\scriptscriptstyle{X}}}\sqrt{\frac{1-\hat{\rho}^2}{n-2}} = \frac{6.8}{16.5}\sqrt{\frac{1-0.4^2}{12-2}} = 0.12
$$

:::{.nonincremental}
- Der kritische t-Wert lautet:
:::

$$
t_{(1-\frac{\alpha}{2},\,n-2)} = t_{(0.975,\,10)} = 2.23
$$

:::{.nonincremental}
- Damit ergibt sich das Konfidenzintervall zu
:::

$$
CI=\hat{b}_1\pm t_{(1-\frac{\alpha}{2},\,n-2)}\cdot\hat{se}=0.16\pm 2.23\cdot 0.12=0.16\pm 0.27 = [-0.11;0.43]
$$

<!----------------->
<!--- New slide --->
<!----------------->
## [Konfidenzintervalle für Regressionskoeffizienten]{color="darkred"}

<div class="vspace-xlarge"></div>

:::: {.columns}
::: {.column width="58%"}
:::{.nonincremental}
- Die maximale Steigung innerhalb des 95%-Konfidenz-intervalls beträgt also $-0.11$ und die minimale Steigung $0.43$.
- Auch der y-Achsenabschnitt $\hat{b}_0$ ist mit einer gewissen Unsicherheit verbunden.
- In Regressionsplots wird der Bereich *aller mit dem Konfidenzintervall kompatiblen Steigungen und y-Achsenabschnitte* häufig als farblich hinterlegte Fläche angedeutet (hellgrau in der Abbildung rechts).
:::
:::
::: {.column width="42%"}

![Beispiel für einen Regressionsplot mit der geschätzten Regressionsgeraden (schwarz) und dem 95%-Konfidenzintervall (hellgrau). Die rote und blaue Line zeigen beispielhaft Regressionsgeraden, die mit dem 95%-Konfidenzintervall kompatibel wären.](images/ci_reg_v2.png)

:::
::::


## [Konfidenzintervalle für Anteile / relative Häufigkeiten]{color="darkred"}{#prop}

**Beispiel:** Wie viele Menschen in Deutschland ernähren sich vegetarisch? Statista liefert einen Anteil von 7,5 % (Grundlage 25.677 Befragte). Das RKI liefert einen Anteil von 4 % (Grundlage 6.933 Befragte).

![](images/anteil_vegetarisch.png){height=490px}

<div class="vspace-small"></div>

**Können wir für die beiden Angaben ein Konfidenzintervall angeben?**

## [Konfidenzintervalle für Anteile / relative Häufigkeiten]{color="darkred"}

:::{.nonincremental}
- **Relative Häufigkeiten** (**Anteile**) setzen eine Teilmenge $k$, die ein bestimmtes Kriterium erfüllt, ins Verhältnis zur Gesamtmenge $n$:
:::

:::{style="margin-top: -30px; margin-bottom: 10px"}
$$
\hat{p} = \frac{k}{n}
$$
:::

:::{.nonincremental}
- Das ^ bringt hier zum Ausdruck, dass wir in der Regel nicht die gesamte Population $N$ untersuchen, sondern eine Stichprobe der Größe $n$ und daher der gemessene Anteil $\hat{p}$ nur eine Schätzung für den wahren Anteil $p$ in der Population darstellt.
- Im Vegetarier-Beispiel wäre interessant, mit welcher Unsicherheit die Prozentschätzungen behaftet sind &xrarr; Konfidenzintervall!
- Die Stichprobenverteilung von relativen Häufigkeiten $p$ ist eine **Binomialverteilung**. Ihr Standardfehler ist bekannt:
:::

$$
\hat{se}(\hat{p}) = \sqrt{\frac{\hat{p}(1-\hat{p})}{n}}\quad\scriptsize\text{(Achtung: p steht hier für den Anteil ("proportion") und nicht den p-Wert!)}
$$

:::{.nonincremental}
- Der Standardfehler wäre ein erstes mögliches Maß für die Unsicherheit unserer Schätzung<br>[(zur Erinnerung: der Standardfehler ist das 68%-Konfidenzintervall)]{style="font-size: 23px"}
:::


## [Konfidenzintervalle für Anteile / relative Häufigkeiten]{color="darkred"}

:::: {.columns}
::: {.column width="55%"}
:::{.nonincremental}
- Ähnlich wie der Korrelationskoeffizient sind Anteile auf einen Bereich eingeschränkt (0 bis 1 bzw. 0 bis 100%) und weisen daher eine **asymmetrische Stichprobenverteilung** auf.
- Sind die Stichprobengrößen $n$ nicht zu klein und die Anteile nicht zu extrem (zu nah bei 0 oder 1), kann die Binomialverteilung jedoch durch die **Normalverteilung approximiert** werden.
- In diesem Fall können z-Werte für die Konstruktion des Konfidenzintervalls verwendet werden^[Zu beachten ist allerdings, dass für die Verwendung des z-Wertes nicht die Verteilung von $p$ relevant ist, sondern die Verteilung der Prüfgröße $\frac{\hat{p}}{\hat{se}}$. Hier handelt es sich dann wieder um das Verhältnis einer (näherungsweise) normalverteilten und einer chi-verteilten Größe, also in Summe einer t-verteilten Prüfgröße. Da es sich aber *ohnehin* nur um eine Näherung handelt, sind die Differenzen zwischen Normal- vs. t-Verteilung für die Prüfgröße vernachlässigbar und der Einfachheit halber wird die Normalverteilung verwendet. Siehe auch [Stackexchange](https://stats.stackexchange.com/questions/411699/why-we-don-t-make-use-of-the-t-distribution-for-constructing-a-confidence-interv).] ^[https://www.econometrics.blog/post/the-wilson-confidence-interval-for-a-proportion/]:
:::

$$
CI(\hat{p}) = \hat{p}\pm z_{(1-\frac{\alpha}{2})}\cdot\hat{se}(\hat{p})
$$

:::
::: {.column width="45%"}
![Stichprobenverteilung für Anteile (Binomialverteilung) für Stichproben der Größe $n=10$ und $n=100$.](images/binom_dist.png)

:::
::::

:::{.nonincremental style="margin-top: -15px"}
- Im Computerzeitalter sollten allerdings für die Konfidenzintervalle von Anteilen präzisere Schätzungen wie das **Wilson-Intervall**^[https://de.wikipedia.org/wiki/Konfidenzintervall_f%C3%BCr_die_Erfolgswahrscheinlichkeit_der_Binomialverteilung#Wilson-Intervall] verwendet werden.
:::

::: {.notabene}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
**Beachte:** bei präziseren Schätzmethoden wie dem Wilson-Intervall ist der wahrscheinlichste Populationswert (und damit der Ankerpunkt für das Konfidenzintervall) nicht mehr $\hat{p}$ sondern ein etwas kleinerer (bei $\hat{p}<0.5$) bzw. größerer (bei $\hat{p}>0.5$) Wert. Zudem handelt es sich um asymmetrischer Konfidenzintervalle.
:::
::::
:::

## [Konfidenzintervalle für Anteile / relative Häufigkeiten]{color="darkred"}

:::{.nonincremental}
- In unserem Vegetarierbeispiel sind die Fallzahlen sehr groß ($n=6933$ und $n=25.677$), so dass eine Näherung mit der Normalverteilung angemessen ist. Wir können diese daher zur Einschätzung der (Un)Sicherheit der Prozentangaben nutzen.
- Für die Standardfehler erhalten wir:
:::

$$
\hat{se}_\text{RKI} = \sqrt{\frac{\hat{p}(1-\hat{p})}{n}} = \sqrt{\frac{0.04(1-0.04)}{6933}} = 0.0024\\ 
\hat{se}_\text{Statista} = \sqrt{\frac{0.075(1-0.075)}{25677}} = 0.0016 
$$

:::{.nonincremental}
- Den kritischen z-Wert für ein 95%-Intervall kennen wir mittlerweile aus dem FF: 1,96
- Damit ergibt sich für die Konfidenzintervalle:
:::

$$
CI_\text{RKI} = \hat{p}\pm z_{(1-\frac{\alpha}{2})}\cdot\hat{se}(\hat{p})  = 0.04\pm 1.96\cdot0.0024 = [0.0353; 0.0447] \\
CI_\text{Statista} = 0.075\pm 1.96\cdot0.0016 = [0.0719; 0.0781]
$$

:::{.nonincremental}
- Da das Konfidenzintervall in beiden Fällen weniger als 1% umfasst (prüfe nach!), sind die Schätzung tatsächlich recht präzise. Zugleich widersprechen sich beide Schätzungen (warum?).
:::



<!-- ## [Konfidenzintervalle für Streuungsmaße]{color="darkred"}{#disp}

![](images/kein_klausurstoff.png){.absolute bottom=0 right=0 height=100px}

:::: {.columns}
::: {.column width="60%"}

:::{.nonincremental}
- Auch für **Streuungsmaße** wie die Varianz oder Standardabweichung können Konfidenzintervalle berechnet werden &mdash; allerdings tritt dieser Fall wesentlich seltener auf.
- Grund: Streuungsmaße sind **selten Gegenstand wissenschaftlicher Fragestellungen**.
- Ein wichtige Ausnahme, bei der die Streuung von Interesse ist, ist die Varianz von Mittelwerten im
Rahmen einer **Varianzanalyse** (&rarr; Statistik 2!).
:::
:::
::: {.column width="40%"}
![xkcd#2110^[https://xkcd.com/2110/]](images/xkcd2110.png){style="margin-top: 50px"}
:::
:::: -->



## [Konfidenzniveau und Wahrscheinlichkeit]{color="darkred"}{#niveau}
![](images/kein_klausurstoff.png){.absolute bottom=0 right=0 height=90px}

Es ist verführerisch anzunehmen, dass z.B. ein 95%-Konfidenzniveau bedeutet, dass der wahre Populationskennwert mit einer Wahrscheinlichkeit von 95% innerhalb des Konfidenzintervalls liegt. **Dem ist nicht so.**

Der Populationskennwert ist ein fixer Wert und keine Zufallsvariable. Entweder liegt er in einem gegebenen Konfidenzintervall (p=1) oder nicht (p=0).

Die Crux liegt im  Detail der Formulierung "in einem [gegebenen]{.underline} Konfidenzintervall".
 **Nach der Erhebung der Stichprobe** (also für ein [gegebenes]{.underline} Konfidenzintervall) ist es wie erwähnt im Kontext der Nullhypthesentestung sinnlos eine Wahrscheinlichkeit anzugeben, dass der Populationskennwert in diesem Intervall liegt.

Anders ist die Situation **vor Erhebung einer Stichprobe** (d.h. bevor das Konfidenzintervall gegeben ist) &mdash; in diesem Fall können wir folgende Feststellung treffen:

::: {.greybox style="width: 88%"}
Das Konfidenzniveau gibt die Wahrscheinlichkeit an, mit der das Konfidenzintervall einer [zu erhebenden]{.underline} Stichprobe den wahren Populationskennwert einschließt.
:::


## [Konfidenzniveau und Wahrscheinlichkeit]{color="darkred"}
![](images/kein_klausurstoff.png){.absolute bottom=0 right=0 height=90px}

Diese Feststellung ist zugegebenermaßen etwas sehr theoretisch &mdash; schließlich interessieren wir uns in der Praxis für die Interpretation des Konfidenzintervalls genau dann, *wenn* wir Daten erhoben haben und das Intervall berechnet haben.

Alternativ können wir daher das gleiche Prinzip einfach auf [zukünftige]{.underline} hyothetische Stichprobenerhebungen nach der aktuellen Stichprobe anwenden. Wir gehen dabei von der **Wahrscheinlichkeit** einer einzelen (noch vor uns liegenden) Stichprobenerhebung zu einer **Frequenz** bei zukünftigen Stichprobenerhebungen über. Dies führt zur (jedoch kaum intuitiveren &#128521;) **Textbuchdefinition des Konfidenzniveaus**:

::: {.definition .table-justify}
<!---  Definition--->
|||
|:-:|-|
|||
| ![](images/definition.svg){height=70px} | Das [**Konfidenzniveau**]{color="navy"} gibt die relative Häufigkeit an, mit der Konfidenzintervalle zukünftiger Stichproben den wahren Populationsparameter einschließen. \
Bei einem 95%-Konfidenzintervall erwarten wir also, dass 95% der hypothetischen (zukünftigen) Stichproben ein Konfidenzintervall aufweisen, das den Populationsparameter einschließt. | 
|||
: {tbl-colwidths="[15, 85]"}
:::

<div class="vspace-large"></div>

Auch hier gilt die *Erste Regel von Konfidenzintervallen*:

::: {.colorbox style="text-align: center !important; margin-left: auto; margin-right: auto; background-color: white; border-width: 0; width: 80%"}
Konfidenzintervalle sind **nützlich** aber **nicht intuitiv**.
:::



<!----------------->
<!--- New slide --->
<!----------------->
<!--![Bei einem 95%-Konfidenzintervall weisen 95% aller hypothetischen zusätzlichen Stichproben Intervall-grenzen auf, die den wahren Wert einschließen. Im Beispiel sind die 5 Ausnahmen rot markiert, in denen der wahre Populationsparameter $\mu$ nicht innerhalb der Interallgrenzen liegt.^[https://shiny.rit.albany.edu/stat/confidence/]](images/CI95_simulation.png){width=262px style="margin-top: -35px !important"} -->


<!----------------->
<!--- New slide --->
<!----------------->
:::{.content-hidden when-format="pdf"}
## [https://bcdudek.net/confidence/]{color="darkred"}
<iframe width=100% height=100% src="https://bcdudek.net/confidence/"></iframe>
![](images/kein_klausurstoff.png){.absolute top=10 right=0 height=65px}
:::



<!----------------->
<!--- New slide --->
<!----------------->
## [Konfidenzintervall-Beispiel von Welch]{color="darkred"}{#welch}

![](images/kein_klausurstoff.png){.absolute top=10 right=0 height=100px}

:::{.nonincremental}
- Auf den Statistiker Bernard Welch ("Welch's t-Test") geht ein berühmtes Beispiel zurück,<br>das eindrucksvoll zeigt, warum die Interpretation des Konfidenzniveaus als "*Wahrscheinlichkeit, dass der Populationsparameter im Intervall liegt*" nur [vor]{.underline} der Beobachtung der Daten zulässig ist.
:::

:::{style="margin-top: -15px"}
:::: {.columns}
::: {.column width="69%"}
:::{.nonincremental}
- Es sei bekannt, dass eine Zufallsvariable $X$ einer uniformen Verteilung folgt, die im Intervall $[\theta-\frac{1}{2}; \theta+\frac{1}{2}]$ angesiedelt ist.
- Der genaue "Shift" $\theta$ der Verteilung auf der x-Achse ist unbekannt und soll durch Messen von $X$ bestimmt werden.
- Tatsächlich werden nur zwei Messwerte von $X$ erhoben, $x_1$ & $x_2$.
:::
:::
::: {.column width="31%"}
![](images/ci_welch_example.png)
:::
::::
:::

:::{style="margin-top: -45px"}
[Vor der Messung:]{.underline}
:::

:::{style="margin-top: -13px"}
:::{.nonincremental}
- Bei exakt zwei durchzuführenden Messungen $x_1$ und $x_2$ wissen wir, dass das Intervall $[\text{min}(x_1, x_2); \text{max}(x_1, x_2)]$ ein 50%-Konfidenzintervall für $\theta$ darstellt.
- Warum? Der Populationsparameter $\theta$ befindet sich *genau dann* in diesem Intervall, wenn $x_1$ und $x_2$ auf unterschiedlichen Seiten von $\theta$ liegen. Diese Wahrscheinlichkeit ist genau 50%.
  - Warum? Die Wahrscheinlichkeit, dass $x_1$ links von $\theta$ (also im Intervall $L$) liegt ist $\frac{1}{2}$, ebenso die Wahrscheinlichkeit, dass $x_2$ rechts von $\theta$ (also im Intervall $R$) liegt. Die Gesamtwahrscheinlichkeit für diesen Fall ist also $\frac{1}{2}\cdot\frac{1}{2}=\frac{1}{4}$. Der umgekehrte Fall, dass $x_1$ rechts von $\theta$ und $x_2$ links von $\theta$ liegt hat ebenfalls die Wahrscheinlichkeit $\frac{1}{4}$. Die kombinierte Wahrscheinlichkeit beider Fälle ist daher $\frac{1}{4}+\frac{1}{4}=\frac{1}{2}$ oder 50%.
:::
:::

## [Konfidenzintervall-Beispiel von Welch]{color="darkred"}

![](images/kein_klausurstoff.png){.absolute top=10 right=0 height=100px}

:::: {.columns}
::: {.column width="69%"}
[Nach der Messung:]{.underline}

Nehmen wir an, dass wir nun zwei Messwerte $x_1$ und $x_2$ erhoben haben und außerdem, dass diese weiter als $0.5$ auseinanderliegen ($|x_1-x_2|>0.5$). Um es konkret zu machen, sagen wir $x_1=1.2$ und $x_2 = 1.8$.

In dieser Situation wissen wir nun mit **100% Sicherheit**, dass $\theta$ in unserem Intervall

$$
CI = [\text{min}(x_1, x_2); \text{max}(x_1, x_2)] = [1.2; 1.8]
$$

:::
::: {.column width="31%"}

![](images/ci_welch_example2.png){style="margin-top:45px !important"}

:::
::::

:::{style="margin-top: -10px"}
liegt. Warum? $\theta$ kann nicht kleiner als $1.3$ sein, denn sonst wäre es nicht möglich gewesen, einen Messwert $1.8$ zu erhalten (beachte, dass der Bereich rechts und links von $\theta$ nur $0.5$ umfasst!). Ebenso kann $\theta$ nicht größer als $1.7$ sein, denn sonst wäre es nicht möglich gewesen, einen Messwert von $1.2$ zu erhalten.
:::

**&rArr; die Wahrscheinlichkeit, dass $\theta$ im Konfidenzintervall $[1.2; 1.8]$ liegt, ist 100%.**

::: {.colorbox}
**Bottom line:** das [**Konfidenzniveau**]{color="navy"} gibt nur [vor der Messung]{.underline} die Wahrscheinlichkeit an, dass der Populationsparameter $\theta$ im Konfidenzintervall liegen wird. [Nach der Messung]{.underline} &mdash; und damit in der Praxis &mdash; gilt dies nicht mehr.
:::
