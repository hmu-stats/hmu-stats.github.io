---
title: "Vorlesung 12: Konfidenzintervalle"
---


## {.blackslide .center}

<div class="vspace-small"></div>

:::: {.columns}
::: {.column width="68%"}

![](images/paradoxia_histogram_inflammation_sem_nonsig.png){height=290px}

:::
::: {.column width="32%"}
::: {.content-hidden when-format="pdf"}
![](images/paradoxia_group_of_scientists.png){.hcenter-image height=200px style="margin-top:-20px !important"}

:::
:::
::::

Sie haben nun die valide Signifikanz Ihrer Ergebnisse mithilfe des t-Tests bestimmt. Der Switch vom z- zum t-Test hat zur absurden Situation geführt, dass trotz sehr ähnlicher p-Werte, ersterer den Entzündungseffekt als signifikant wertet, letzterer aber nicht.

Um die Beurteilung der Signifikanz des Ergebnisses nicht einer Nachkommastelle zu überlassen, streben Sie für die Kommunikation der Ergebnisse gegenüber staatlichen Gremien und der Öffentlichkeit ein anderes Maß an.

Statt die Signifikanz mit Nein/Ja zu beurteilen, wollen Sie eine **graduelle Aussage** darüber treffen, wie vertrauenswürdig die jeweiligen Mittelwertschätzungen Ihrer Messungen sind. Diese Überlegung führt Sie zum [**Konfidenzintervall**]{.navy-paradoxia}.


<!-- ```{python}
import numpy as np
import matplotlib.pyplot as plt
import os

root = '/home/matteo/OneDrive/lehre/Statistik/stats1_lecture/book/'
fontsize = 14
plt.style.use('dark_background')
plt.figure(figsize=(7, 3))
ax = plt.subplot(121)
ax.set_facecolor('#ddd')
[lb, ub] = [0.333, 0.821]
deltaX = 0.577
plt.bar(0, deltaX, facecolor='#888', width=0.2)
plt.errorbar(0, deltaX, yerr=deltaX-lb, fmt='o', markersize=4, capsize=6, capthick=1.5, elinewidth=1.5, ecolor='black', mfc='black', mec='black', zorder=3, label="95%-Kofidenzintervall")
plt.xticks([0], ['TikTok'], fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.ylabel('TikTok-Effekt (Δ)', fontsize=fontsize)
plt.xlim(-0.2, 0.2)
# plt.legend(loc='center left', bbox_to_anchor=(0.8, 0.85), fontsize=fontsize-3)

ax = plt.subplot(122)
ax.set_facecolor('#ddd')
[lb, ub] = [-0.0049, 0.0535]
deltaX = 0.0243
plt.bar(0, deltaX, facecolor='#888', width=0.2, label='Paradoxia −\nKontroll')
plt.errorbar(0, deltaX, yerr=deltaX-lb, fmt='o', markersize=4, capsize=6, capthick=1.5, elinewidth=1.5, ecolor='black', mfc='black', mec='black', zorder=3, label="95%-\nKofidenz-\nintervall")
plt.plot([-0.2, 0.2], [0, 0], 'k-', lw=0.5)
plt.xticks([0], ['Entzündung'], fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.ylabel('Entzündungseffekt (Δ)', fontsize=fontsize)
plt.xlim(-0.2, 0.2)
plt.ylim(-0.01, 0.055)
leg = plt.legend(loc='center left', bbox_to_anchor=(1, 0.5), fontsize=fontsize-3, labelcolor='k', framealpha=1)
leg.get_frame().set_facecolor('#ddd')

plt.tight_layout()

plt.savefig(os.path.join(root, 'images', 'paradoxia_ci.png'), bbox_inches="tight")
``` -->


<!-- ```{python}


import seaborn as sns
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

root = '/home/matteo/OneDrive/lehre/Statistik/stats1_lecture/book/'
fontsize = 14


df = pd.read_csv(os.path.join(root, 'data', 'paradoxia.csv'))
df = df[df.group == 2]
x = df['hours_tiktok_per_day'].values
y = df['inflammation'].values
n = len(x)

plt.style.use('dark_background')
plt.figure(figsize=(8.5, 3))

ax = plt.subplot(121)
ax.set_facecolor('#ddd')
reg = linregress(x, y)
sns.regplot(df, x='hours_tiktok_per_day', y='inflammation', color='grey', ci=95, n_boot=10000, line_kws={"color": 'red'})
plt.text(0.05, 0.9, f'$r={reg.rvalue:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.text(0.05, 0.81, f'$b_1={reg.slope:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.xticks(fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.xlim(0, 3)
plt.ylim(0, 0.31)
plt.xlabel('Stunden TikTok / 24h', fontsize=fontsize)
plt.ylabel('Entzündungswert', fontsize=fontsize)

ax = plt.subplot(122)
ax.set_facecolor('#ddd')
reg = linregress(y, x)
sns.regplot(df, x='inflammation', y='hours_tiktok_per_day', color='grey', ci=95, n_boot=10000, line_kws={"color": 'red'})
plt.fill_between([10, 20], [0, 0], [1, 1], color='#e2bcbc', label='95%-\nKonfidenz-\nintervall')
plt.text(0.05, 0.9, f'$r={reg.rvalue:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.text(0.05, 0.81, f'$b_1={reg.slope:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.xticks(fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.xlim(0, 0.31)
plt.ylim(0, 3)
plt.xlabel('Entzündungswert', fontsize=fontsize)
plt.ylabel('Stunden TikTok / 24h', fontsize=fontsize)
leg = plt.legend(loc='center left', bbox_to_anchor=(1, 0.5), fontsize=fontsize-3, labelcolor='k', framealpha=1)
leg.get_frame().set_facecolor('#ddd')

plt.tight_layout()

plt.savefig(os.path.join(root, 'images', 'paradoxia_ci_reg.png'), bbox_inches="tight")
``` -->


<!-- ## Der Forschungsprozess {.hcenter-slide}

```yaml { .animate src="images/scientific_process.svg"}
setup:
    - element: "#inference"
      modifier: function() { this.node.style.fill = 'green'; }
    - element: "#inferencebg"
      modifier: function() { this.node.style.fill = '#d8ffe2';}
``` -->



## Rückblick

:::{.nonincremental}
- Wir hatten das Konzept der Signifikanztestung anhand des **z-Tests** eingeführt, der auf der standardisierten Prüfgröße $z=\frac{\hat{\theta}}{se}$ basiert.
- Für ein gegebenes Signifikanzniveau $\alpha$ lässt sich ein kritischer z-Wert $\pm z_\text{crit}$ bestimmen: gilt $z < -z_\text{crit}$ oder $z > +z_\text{crit}$, so wird ein Effekt als signifikant gewertet (zweiseitiger Test).
:::

:::: {.columns .fragment}
::: {.column width="50%"}

:::{style="margin-top: -10px"}
:::{.nonincremental}
- Zugleich definiert das Signifikanzniveau ein Intervall $[-z_\text{crit}; z_\text{crit}]$, in dem der Effekt [nicht]{.underline} signifikant wäre.
  - Dieses Intervall &mdash; in der Abbildung bezeichnet als "Nicht-signifikanter Bereich" &mdash; hängt nicht von den Daten ($\hat{\theta}$, $se$) ab, sondern ausschließlich vom gewählten Signifikanzniveau  $\alpha$.
  - Im nicht-signifikanten Bereich werden Stichprobeneffekte als *mit der Nullhypothese kompatibel* gewertet, bzw. ein Effekt in diesem Intervall würde die *Nullhypothese nicht ablehnen*.
:::
:::
:::
::: {.column width="50%"}

![](images/ci_motivation_left.png){height=380px  style="margin-top: -10px !important"}

:::
::::

## Konfidenzintervall

![](images/ci_motivation.png){height=335px}

:::{.nonincremental}
- Projizieren wir diesen *nicht-signifikanten Bereich* der Standardnormalverteilung zurück in den Raum der Stichprobenverteilung ($\cdot se$, $+\hat{\theta}$), so wird er [**Konfidenzintervall**]{color="navy"} genannt und umfasst folgenden Wertebereich:
:::

:::{style="margin-top: -17px; margin-bottom: 7px"}
$$
\text{Konfidenzintervall:}\qquad CI=\hat{\theta}\pm z_\text{crit}\cdot se
$$
:::

<!-- - In Analogie zum z-Raum können wir formulieren: das **Konfidenzintervall** definiert einen Bereich hypothetischer Stichprobeneffekte $\Delta\bar{x}_\text{hypo}$,  die, *unter der Annahme, dass der beobachtete Stichprobenkennwert $\Delta\bar{x}$ dem wahren Kennwert $\Delta\bar{x}_\text{true}$ entspricht*, nicht unwahrscheinlich sind. -->
- Das Konfidenzintervall umfasst 100·(1-α)% der Stichprobenverteilung (also z.B. 95% bei $\alpha=0.05$).

<!-- ## Konfidenzintervall


::: {.notabene .vcenter style="font-size: 25px"}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
[**Hinweis:**]{.underline} wir verwenden im Weiteren für die Einführung von Konfidenzintervallen den Mittelwertsunterschied $\Delta\bar{x}$ stellvertretend als einen Effekt der uns als Forscher:innen interessiert. Konfidenzintervalle lassen sich jedoch für viele verschiedene Effekte berechnen (z.B. Korrelationen).

Noch etwas allgemeiner gesprochen werden Konfidenzintervalle für **unbekannte Populationsparameter $\theta_i$** von Modellen bestimmt, die gemessen abhängige Variable vorhersagen. Ein solcher Parameter kann ein Gruppenunterschied $\Delta\bar{x}$ sein, ein Regressionskoeffizient $b_1$ oder ein Parameter in einem komplexeren kognitiven Modell (z.B. die Lernrate $\alpha$ in einem Reinforcement-Learning-Modell).

:::
::::
::: -->


## Definition

Die Projektion des nicht-signifikanten Bereiches in den Stichprobenkennwert-Raum führt zu einer ersten Definition von Konfidenzintervallen:

::: {.definition}
<!---  Definition--->
|||
|:-:|-|
|||
| ![](images/definition.svg){height=70px} | Ein [**Konfidenzintervall**]{color="navy"} definiert einen Bereich möglicher Populationskennwerte $\theta$, die nicht signifikant verschieden von der Punktschätzung $\hat{\theta}$ sind (auf Basis des Signifikanzniveaus $\alpha$). | 
|||
: {tbl-colwidths="[10, 90]"}
:::

- Einfacher gesprochen enthält das Konfidenzintervall also mögliche Populationskennwerte $\theta$, die als statistisch kompatibel mit der Punktschätzung $\hat{\theta}$ gewertet werden. 

<div class="vspace-large"></div>

::: {.notabene .fragment}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}

Im Kontext von Konfidenzintervallen wird der Stichprobenkennwert $\hat{\theta}$ häufig als **Punktschätzung** bezeichnet. Damit wird betont, dass es sich 1) um einen Einzelwert und keinen Wertebereich handelt ("Punkt..."), und 2) dass dieser Wert nur eine Schätzung des wahren Wertes darstellt ("...schätzung").

Durch die Projektion in den Stichprobenkennwert-Raum ($\cdot se$, $+\hat{\theta}$) vergleichen wir konzeptuell gesehen nicht mehr $\hat{\theta}$ mit der Null (wie bei der Signifikanztestung), sondern mögliche Populationskennwerte $\theta$ mit der Punktschätzung $\hat{\theta}$. Letztlich sind Signifikanztestung und Konfidenzintervalle aber lediglich zwei Betrachtungsweisen desselben Sachverhaltes.

<!-- Auch wenn das Konfidenzintervalls um die Punktschätzung herum konstruiert wird, kann ein Signifikanztest nie auf Basis einer Verteilung um die Punktschätzung durchgeführt werden. Wie bei der Nullhypothese basieren auch die (hypothetischen) Signifikanztests in der Definition des Konfidenzintervalls auf Verteilungen um fixe angenommene Werte der Population. Berechnet wird *immer* die Wahrscheinlichkeit der Stichprobendaten *gegegeben* einer Annahme über den Populationsparameter $\theta$ (bei der Nullhypothese $\theta=0$). -->

:::
::::
:::



## Intution zu Konfidenzintervallen

*Was bedeutet es, ob ein Konfidenzintervall größer oder klein ist?* Auf Basis unserer Definition können wir feststellen:

- Ist das **Konfidenzintervall** bei einem gegebenen $\alpha$ **verhältnismäßig klein**, so gäbe es auch nur einen kleinen Bereich möglicher Populationskennwerte $\theta$ die kompatibel (im Sinn von "nicht signifikant verschieden") mit unserer Punktschätzung $\hat{\theta}$ sind.
  - Wir können in diesem Fall davon ausgehen, dass unsere **Punktschätzung $\hat{\theta}$ recht präzise** ist.
- Ist das **Konfidenzintervall** bei einem gegebenen $\alpha$ **verhältnismäßig groß**, so ist der Bereich kompatibler Populationskennwerte $\theta$ größer. 
  - In diesem Fall ist unsere **Punktschätzung $\hat{\theta}$ mit mehr Unsicherheit behaftet**.
- Zusammenfassend bemisst das Konfidenzintervall also die **Vertrauenswürdigkeit einer Punktschätzung $\hat{\theta}$** (z.B. $\bar{x}$, $\Delta\bar{x}$, $\hat{\rho}$, usw).<br>**Je kleiner** das Intervall, **desto präziser** ist die Schätzung $\hat{\theta}$ des Populationskennwertes $\theta$.
<div class="vspace-large"></div>

::: {.notabene .fragment style="font-size: 26px !important"}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
Dürfte man den Namen von Konfidenzintervall neu wählen, wäre [**Kompatibilitäsintervall**]{color="navy"} ein sinnvoller(er) Begriff, da das Intervall im obigen Sinne eben genau **jene Populationskennwerte $\theta$ einschließt, die statistisch kompatibel mit dem Stichprobenkennwert $\hat{\theta}$ sind**.
:::
::::
:::

# Konfidenzniveau

<!----------------->
<!--- New slide --->
<!----------------->
## Konfidenzniveau

:::: {.columns}
::: {.column width="48%"}
:::{.nonincremental}
- Konfidenzintervalle können für verschiedene [**Konfidenzniveaus**]{color="navy"} (auch "Überdeckungs-wahrscheinlichkeiten") angegeben werden:
:::

$$
\text{Konfidenzniveau:}\qquad 1-\alpha
$$

:::
::: {.column width="52%"}

![](images/ci_68_90.png){width=650px style="margin-top:-20px !important"}

:::
::::

- Das gängiste Konfidenzniveau basiert auf $\alpha=0.05$ und damit $1-\alpha=0.95$. Es wird als **95%-Konfidenzniveau** bzw. das Intervall als **95%-Konfidenzintervall** bezeichnet.
  - Signifikanzniveau $\alpha=0.01$ &numsp;&xrarr;&numsp; Konfidenzniveau $1-\alpha=0.99$ &numsp;&xrarr;&numsp; 99%-Kofidenzintervall
  - Signifikanzniveau $\alpha=0.1$ &numsp;&xrarr;&numsp; Konfidenzniveau $1-\alpha=0.9$ &numsp;&xrarr;&numsp; 90%-Kofidenzintervall
  - usw.


:::: {.columns .fragment}
::: {.column width="72%"}
:::{.nonincremental}
- Grundsätzlich gilt: **je höher das zugrundegelegte Konfidenzniveau, desto größer das zugehörige Konfidenzintervall eines Effektes $\hat{\theta}$.**
- Bonus: [eine präzise (aber wenig intuitive) Interpretation des Konfidenzniveaus](#niveau){style="color: darkred"} und ein zugehöriges [Beispiel von Bernard Welch](#welch){style="color: darkred"}.
:::
:::
::: {.column width="28%"}
:::{style="margin-top:-60px"}
![](images/ci_sizes.png){height=250px}
:::
:::
::::


<!----------------->
<!--- New slide --->
<!----------------->
## Konfidenzniveau und kritischer z-Wert

:::: {.columns}
::: {.column width="60%"}

:::{.nonincremental}
- Jedes Konfidenzniveau $1-\alpha$ ist mit einem kritischen z-Wert $z_\text{crit}$ verbunden.
- Da Konfidenzintervalle immer zweiseitig sind, verteilt sich die Irrtumswahrscheinlichkeit $\alpha$ auf beide Flanken der Standardnormalverteilung. Folgende Nomenklatur für kritische z-Werte hat sich deshalb eingebürgert:
:::

:::{style="margin-top: -20px"}
$$
z_\text{crit} = z_{(1-\frac{\alpha}{2})}
$$
:::

:::
::: {.column width="40%"}
![](images/ci_zcrit.png)
:::
::::


- Zu jedem **Konfidenzniveau** $1-\alpha$ lässt sich also ein [**kritischer z-Wert**]{color="navy"} $\color{navy}{z_{(1-\frac{\alpha}{2})}}$ zuordnen.
- Damit haben wir folgende aktualisierte Formel des Konfidenzintervalls:

::: {.colorbox .fragment style="margin-top: -7px"}
$$
\text{Konfidenzintervall:}\qquad CI=\hat{\theta}\pm z_{(1-\frac{\alpha}{2})}\cdot se
$$
:::


- Der kritische z-Wert wird wie bisher auf Basis der Verteilungsfunktion $\Phi$ der Standardnormalverteilung berechnet (&rarr; z-Tabelle!):

:::{.fragment style="margin-top: -20px"}
$$
z_{(1-\frac{\alpha}{2})} = \Phi\left(1-\frac{\alpha}{2}\right)
$$
:::


## Kritischer t-Wert: Populationsstreuung nicht bekannt

:::{.nonincremental}
- Wie bereits festgestellt ist die zentrale Annahme bei z-Werten &mdash; Populationsstreuungen bekannt &mdash; in der Praxis nahezu nie zutreffend.
- Die Abhilfe ist hier prinzipiell analog zur Signifikanztestung: sind der **Standardfehler $se$ oder die Merkmalsstreuungen $\sigma$ nicht bekannt**, so **ersetzen wir den kritischen z-Wert $z_{(1-\frac{\alpha}{2})}$ durch den [kritischen t-Wert $t_{(1-\frac{\alpha}{2},\;\text{df})}$]{color="navy"}**:
:::


::: {.colorbox style="margin-top: 5px"}
$$
\text{Konfidenzintervall:}\qquad CI=\hat{\theta}\pm t_{(1-\frac{\alpha}{2},\;\text{df})}\cdot \hat{se}
$$

[(Beachte auch den Übergang von $se$ zu $\hat{se}$, da wir nun die Streuung auf Basis der Stichprobe schätzen)]{style="font-size: 22px; margin-left: 50px"}
:::

- Der kritische t-Wert $t_{(1-\frac{\alpha}{2},\;\text{df})}$ kann der t-Tabelle entnommen werden.

<div class="vspace-xlarge"></div>

::: {.notabene .fragment}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
Eine wichtige Ausnahme sind **Konfidenzintervalle zu Korrelationskoeffizienten**: hier hat es sich eingebürgert auch dann einen z-Test zu verwenden, wenn die Populationsstreuungen unbekannt sind. Da Korrelationskoeffizienten aber ohnehin ein Spezialfall sind und eine spezielle Transformation benötigen, behandeln wir diese noch gesondert.
:::
::::
:::


<!-- ## Populationsstreuung nicht bekannt

<div class="vspace-xlarge"></div>

:::{.nonincremental}
Allerdings:
- Ob für die Berechnung eines Konfidenzintervalls der kritischer z-Wert $z_{(1-\frac{\alpha}{2})}$ oder der kritische t-Wert $t_{(1-\frac{\alpha}{2},\;\text{df})}$ verwendet wird, ist in der statistischen Praxis häufig nicht ganz konsistent.
    - Bei Konfidenzintervallen von Mittelwerten $\bar{x}$ und Mittelwertdifferenzen $\Delta\bar{x}$ wird $t_{(1-\frac{\alpha}{2},\;\text{df})}$ verwendet.
    - Bei Konfidenzintervallen von Korrelationen $r$ hat es sich eingebürgert, $z_{(1-\frac{\alpha}{2})}$ zu verwenden (in Kombination mit der Fisher-z-Transformation).
    - Bei Konfidenzintervallen von Regressionskoeffizienten $b_i$ wird $t_{(1-\frac{\alpha}{2},\;\text{df})}$ verwendet.
    - Bei Konfidenzintervallen von Proportionen/Anteilen $\hat{p}$ wird $z_{(1-\frac{\alpha}{2})}$ verwendet &mdash; dies hängt hier aber damit zusammen, dass die t-Verteilung für Proportionen/Anteile nicht valide ist.
:::

**Im Weiteren halten wir uns an diese Konventionen der statistischen Praxis.** -->
