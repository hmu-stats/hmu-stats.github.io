---
title: "Vorlesung 12: Konfidenzintervalle"
---


## {.blackslide .center}

<div class="vspace-small"></div>

:::: {.columns}
::: {.column width="68%"}

![](images/paradoxia_histogram_inflammation_sem_nonsig.png){height=290px}

:::
::: {.column width="32%"}
::: {.content-hidden when-format="pdf"}
![](images/paradoxia_group_of_scientists.png){.hcenter-image height=200px style="margin-top:-20px !important"}

:::
:::
::::

Sie haben nun die valide Signifikanz Ihrer Ergebnisse mithilfe des t-Tests bestimmt. Der Switch vom z- zum t-Test hat zur absurden Situation geführt, dass trotz sehr ähnlicher p-Werte, ersterer den Entzündungseffekt als signifikant wertet, letzterer aber nicht.

Um die Beurteilung der Signifikanz des Ergebnisses nicht einer Nachkommastelle zu überlassen, streben Sie für die Kommunikation der Ergebnisse gegenüber staatlichen Gremien und der Öffentlichkeit ein anderes Maß an.

Statt die Signifikanz mit Nein/Ja zu beurteilen, wollen Sie eine **graduelle Aussage** darüber treffen, wie vertrauenswürdig die jeweiligen Mittelwertschätzungen Ihrer Messungen sind. Diese Überlegung führt Sie zum [**Konfidenzintervall**]{.navy-paradoxia}.


<!-- ```{python}
import numpy as np
import matplotlib.pyplot as plt
import os

root = '/home/matteo/OneDrive/lehre/Statistik/stats1_lecture/book/'
fontsize = 14
plt.style.use('dark_background')
plt.figure(figsize=(7, 3))
ax = plt.subplot(121)
ax.set_facecolor('#ddd')
[lb, ub] = [0.333, 0.821]
deltaX = 0.577
plt.bar(0, deltaX, facecolor='#888', width=0.2)
plt.errorbar(0, deltaX, yerr=deltaX-lb, fmt='o', markersize=4, capsize=6, capthick=1.5, elinewidth=1.5, ecolor='black', mfc='black', mec='black', zorder=3, label="95%-Kofidenzintervall")
plt.xticks([0], ['TikTok'], fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.ylabel('TikTok-Effekt (Δ)', fontsize=fontsize)
plt.xlim(-0.2, 0.2)
# plt.legend(loc='center left', bbox_to_anchor=(0.8, 0.85), fontsize=fontsize-3)

ax = plt.subplot(122)
ax.set_facecolor('#ddd')
[lb, ub] = [-0.0049, 0.0535]
deltaX = 0.0243
plt.bar(0, deltaX, facecolor='#888', width=0.2, label='Paradoxia −\nKontroll')
plt.errorbar(0, deltaX, yerr=deltaX-lb, fmt='o', markersize=4, capsize=6, capthick=1.5, elinewidth=1.5, ecolor='black', mfc='black', mec='black', zorder=3, label="95%-\nKofidenz-\nintervall")
plt.plot([-0.2, 0.2], [0, 0], 'k-', lw=0.5)
plt.xticks([0], ['Entzündung'], fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.ylabel('Entzündungseffekt (Δ)', fontsize=fontsize)
plt.xlim(-0.2, 0.2)
plt.ylim(-0.01, 0.055)
leg = plt.legend(loc='center left', bbox_to_anchor=(1, 0.5), fontsize=fontsize-3, labelcolor='k', framealpha=1)
leg.get_frame().set_facecolor('#ddd')

plt.tight_layout()

plt.savefig(os.path.join(root, 'images', 'paradoxia_ci.png'), bbox_inches="tight")
``` -->


<!-- ```{python}


import seaborn as sns
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

root = '/home/matteo/OneDrive/lehre/Statistik/stats1_lecture/book/'
fontsize = 14


df = pd.read_csv(os.path.join(root, 'data', 'paradoxia.csv'))
df = df[df.group == 2]
x = df['hours_tiktok_per_day'].values
y = df['inflammation'].values
n = len(x)

plt.style.use('dark_background')
plt.figure(figsize=(8.5, 3))

ax = plt.subplot(121)
ax.set_facecolor('#ddd')
reg = linregress(x, y)
sns.regplot(df, x='hours_tiktok_per_day', y='inflammation', color='grey', ci=95, n_boot=10000, line_kws={"color": 'red'})
plt.text(0.05, 0.9, f'$r={reg.rvalue:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.text(0.05, 0.81, f'$b_1={reg.slope:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.xticks(fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.xlim(0, 3)
plt.ylim(0, 0.31)
plt.xlabel('Stunden TikTok / 24h', fontsize=fontsize)
plt.ylabel('Entzündungswert', fontsize=fontsize)

ax = plt.subplot(122)
ax.set_facecolor('#ddd')
reg = linregress(y, x)
sns.regplot(df, x='inflammation', y='hours_tiktok_per_day', color='grey', ci=95, n_boot=10000, line_kws={"color": 'red'})
plt.fill_between([10, 20], [0, 0], [1, 1], color='#e2bcbc', label='95%-\nKonfidenz-\nintervall')
plt.text(0.05, 0.9, f'$r={reg.rvalue:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.text(0.05, 0.81, f'$b_1={reg.slope:.3f}$', fontsize=fontsize-2, transform=plt.gca().transAxes, color='k')
plt.xticks(fontsize=fontsize-2)
plt.yticks(fontsize=fontsize-2)
plt.xlim(0, 0.31)
plt.ylim(0, 3)
plt.xlabel('Entzündungswert', fontsize=fontsize)
plt.ylabel('Stunden TikTok / 24h', fontsize=fontsize)
leg = plt.legend(loc='center left', bbox_to_anchor=(1, 0.5), fontsize=fontsize-3, labelcolor='k', framealpha=1)
leg.get_frame().set_facecolor('#ddd')

plt.tight_layout()

plt.savefig(os.path.join(root, 'images', 'paradoxia_ci_reg.png'), bbox_inches="tight")
``` -->


## Der Forschungsprozess {.hcenter-slide}

```yaml { .animate src="images/scientific_process.svg"}
setup:
    - element: "#inference"
      modifier: function() { this.node.style.fill = 'green'; }
    - element: "#inferencebg"
      modifier: function() { this.node.style.fill = '#d8ffe2';}
```



## Rückblick

- Wir hatten das Konzept der Signifikanztestung anhand des **z-Tests** eingeführt.
- Anstatt die Signifikanz eines Effektes $\hat{\theta}$ (z.B. $\Delta\bar{x}$, $r$, usw.) unter der Stichprobenverteilung zu testen, standardisieren wir den Effekt zu $z=\frac{\hat{\theta}-\theta_0}{se}$ und testen ihn unter der Standardnormalverteilung [([Hinweis:]{.underline} in den meisten Fällen ist $\theta_0=0$, weshalb wir $\theta_0=0$ ab jetzt weglassen)]{style="font-size:19px"}.
- Für ein Signifikanzniveau $\alpha$ lassen sich die kritischen z-Werte $\pm z_\text{crit}$ bestimmen. Weist die empirische Prüfgröße $z=\frac{\hat{\theta}}{se}$ einen extremeren Wert als $\pm z_\text{crit}$  auf, ist der Effekt signifikant.

:::: {.columns}
::: {.column width="50%"}

:::{style="margin-top: -10px"}
- Zugleich definiert das Signifikanzniveau ein Intervall $[-z_\text{crit}; z_\text{crit}]$, in dem der Effekt nicht signifikant wäre.
  - Dieses Intervall &mdash; in der Abbilung bezeichnet als "Nicht-signifikanter Bereich" &mdash; hängt nicht von den Daten ($\hat{\theta}$, $se$) ab, sondern ausschließlich vom gewählten Signifikanzniveau  $\alpha$.
  - Im nicht-signifikanten Bereich werden die Daten als *mit der Nullhypothese kompatibel* gewertet (wobei das Kriterium kompatibel/inkompatibel durch das Signifikanzniveau $\alpha$ bestimmt wird).
:::
:::
::: {.column width="50%"}

![](images/ci_motivation_left.png){height=380px  style="margin-top: -10px !important"}

:::
::::

## Konfidenzintervall

![](images/ci_motivation.png){height=335px}

- Projizieren wir den nicht-signifikanten Bereich der Standardnormalverteilung in den Raum der Stichprobenverteilung ($\cdot se$, $+\hat{\theta}$), so wird er [**Konfidenzintervall**]{color="navy"} genannt und umfasst folgenden Wertebereich:

:::{style="margin-top: -17px; margin-bottom: 7px"}
$$
\text{Konfidenzintervall:}\qquad CI=\hat{\theta}\pm z_\text{crit}\cdot se
$$
:::

<!-- - In Analogie zum z-Raum können wir formulieren: das **Konfidenzintervall** definiert einen Bereich hypothetischer Stichprobeneffekte $\Delta\bar{x}_\text{hypo}$,  die, *unter der Annahme, dass der beobachtete Stichprobenkennwert $\Delta\bar{x}$ dem wahren Kennwert $\Delta\bar{x}_\text{true}$ entspricht*, nicht unwahrscheinlich sind. -->
- Wir stellen zwei Punkte fest:
  - Die Größe des Intervalls hängt jetzt von den Daten ab ($\hat{\theta}$, $se$).
  - Das Konfidenzintervall umfasst 100·(1-α)% der Stichprobenverteilung (also zB 95% bei $\alpha=0{,}05$).

<!-- ## Konfidenzintervall


::: {.notabene .vcenter style="font-size: 25px"}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
[**Hinweis:**]{.underline} wir verwenden im Weiteren für die Einführung von Konfidenzintervallen den Mittelwertsunterschied $\Delta\bar{x}$ stellvertretend als einen Effekt der uns als Forscher:innen interessiert. Konfidenzintervalle lassen sich jedoch für viele verschiedene Effekte berechnen (z.B. Korrelationen).

Noch etwas allgemeiner gesprochen werden Konfidenzintervalle für **unbekannte Populationsparameter $\theta_i$** von Modellen bestimmt, die gemessen abhängige Variable vorhersagen. Ein solcher Parameter kann ein Gruppenunterschied $\Delta\bar{x}$ sein, ein Regressionskoeffizient $b_1$ oder ein Parameter in einem komplexeren kognitiven Modell (z.B. die Lernrate $\alpha$ in einem Reinforcement-Learning-Modell).

:::
::::
::: -->


## Definition

Die Projektion des nicht-signifikanten Bereiches in den Stichprobenkennwert-Raum führt uns zu einer Definition von Konfidenzintervallen:

::: {.definition}
<!---  Definition--->
|||
|:-:|-|
|||
| ![](images/definition.svg){height=70px} | Ein [**Konfidenzintervall**]{color="navy"} definiert einen Bereich möglicher Populationsparameter $\theta$, die nicht signifikant verschieden von der Punktschätzung $\hat{\theta}$ sind (auf Basis des Signifikanzniveaus $\alpha$). | 
|||
: {tbl-colwidths="[10, 90]"}
:::

- Einfacher gesprochen enthält das Konfidenzintervall also mögliche Populationsparameter $\theta$, die als statistisch kompatibel mit der Punktschätzung $\hat{\theta}$ gewertet werden. 

<div class="vspace-large"></div>

::: {.notabene}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}

Im Kontext von Konfidenzintervallen wird der Stichprobenkennwert $\hat{\theta}$ häufig als "Punktschätzung" bezeichnet. Damit wird betont, dass es sich 1) um einen Einzelwert (und keinen Wertebereich) handelt und 2) dass dieser Wert nur eine Schätzung des wahren Wertes darstellt.

Durch die Projektion in den Stichprobenkennwert-Raum ($\cdot se$, $+\hat{\theta}$) vergleichen wir konzeptuell gesehen nicht mehr $\hat{\theta}$ mit der Null (wie bei der Signifikanztestung), sondern mögliche Populationsparameter $\theta$ mit der Punktschätzung $\hat{\theta}$. Letztlich sind Signifikanztestung und Konfidenzintervalle aber lediglich zwei Betrachtungsweisen desselben Sachverhaltes.

<!-- Auch wenn das Konfidenzintervalls um die Punktschätzung herum konstruiert wird, kann ein Signifikanztest nie auf Basis einer Verteilung um die Punktschätzung durchgeführt werden. Wie bei der Nullhypothese basieren auch die (hypothetischen) Signifikanztests in der Definition des Konfidenzintervalls auf Verteilungen um fixe angenommene Werte der Population. Berechnet wird *immer* die Wahrscheinlichkeit der Stichprobendaten *gegegeben* einer Annahme über den Populationsparameter $\theta$ (bei der Nullhypothese $\theta=0$). -->

:::
::::
:::



## Intution zu Konfidenzintervallen

*Was bedeutet es, ob ein Konfidenzintervall größer oder klein ist?* Auf Basis unserer Definition können wir feststellen:

- Ist das **Konfidenzintervall** bei einem gegebenen $\alpha$ **verhältnismäßig klein**, so gäbe es auch nur einen kleinen Bereich möglicher Populationsparameter die kompatibel (im Sinn von "nicht signifikant verschieden") mit unserer Punktschätzung sind.
  - Wir können in diesem Fall davon ausgehen, dass unsere **Punktschätzung recht präzise** ist.
- Ist das **Konfidenzintervall** (bei gleichem $\alpha$) **verhältnismäßig groß**, so ist der Bereich kompatibler Populationsparameter größer. 
  - In diesem Fall ist unsere **Punktschätzung mit mehr Unsicherheit behaftet**.
- Zusammenfassend bemisst das Konfidenzintervall also die **Vertrauenswürdigkeit einer Punktschätzung $\hat{\theta}$** ($\bar{x}$, $\Delta\bar{x}$, $r$, usw.). **Je kleiner** das Intervall, **desto präziser** ist unsere Schätzung $\hat{\theta}$ des Populationsparameters $\theta$.
<div class="vspace-large"></div>

::: {.notabene style="font-size: 27px !important"}
:::: {.columns}
::: {.column width="7%"}
::: {style="margin-top: 10px"}
![](images/notabene2.png){height="65px"}
:::
:::
::: {.column width="93%"}
Dürfte man den Namen von Konfidenzintervall neu wählen, wäre [**Kompatibilitäsintervall**]{color="navy"} ein sinnvoller(er) Begriff, da das Intervall im obigen Sinne eben genau **jene Populationsparameter einschließt, die kompatibel mit dem Stichprobenkennwert sind**.
:::
::::
:::

# Konfidenzniveau

<!----------------->
<!--- New slide --->
<!----------------->
## Konfidenzniveau

:::: {.columns}
::: {.column width="48%"}
:::{.nonincremental}
- Konfidenzintervalle können für verschiedene [**Konfidenzniveaus**]{color="navy"} (auch "Überdeckungs-wahrscheinlichkeiten") angegeben werden:
:::

$$
\text{Konfidenzniveau:}\qquad 1-\alpha
$$

:::
::: {.column width="52%"}

![](images/ci_68_90.png){width=650px style="margin-top:-20px !important"}

:::
::::

:::: {.columns}
::: {.column width="50%"}

- Das gängiste Konfidenzniveau verwendet $\alpha=0{,}05$ und wird dementsprechend als **95%-Konfidenzintervall** bezeichnet.
  - $\alpha=0{,}01$ &numsp;&xrarr;&numsp; 99%-Kofidenzintervall
  - $\alpha=0{,}1$ &numsp;&xrarr;&numsp; 90%-Kofidenzintervall
  - usw.

:::
::: {.column width="50%"}
![Beispiel für die Verwendung eines 95%-Konfidenzintervalls in einer Publikation^[Huang X, Wang Y, Zhang H (2023) Effects of physical exercise intervention on depressive and anxious moods of college students: A meta-analysis of randomized controlled trials. Asian Journal of Sport and Exercise Psychology Available at: https://www.sciencedirect.com/science/article/pii/S2667239123000011 [Accessed September 14, 2023].
]](images/ci95_example.png){width=550px style="margin-top: 70px"}
:::
::::

:::: {.columns}
::: {.column width="72%"}
- Grundsätzlich gilt: **je höher das zugrundegelegte Konfidenzniveau, desto größer auch das Konfidenzintervall**.
:::
::: {.column width="28%"}
:::{.fragment}
![](images/ci_size.png)
:::
:::
::::


<!----------------->
<!--- New slide --->
<!----------------->
## Konfidenzniveau und kritischer z-Wert

:::: {.columns}
::: {.column width="60%"}

- Jedes Konfidenzniveau $1-\alpha$ ist mit einem kritischen z-Wert $z_\text{crit}$ verbunden.
- Da Konfidenzintervalle immer zweiseitig sind, verteilt sich die Irrtumswahrscheinlichkeit $\alpha$ auf beide Flanken der Standardnormalverteilung. Folgende Nomenklatur für kritische z-Werte hat sich deshalb eingebürgert:

:::{.fragment style="margin-top: -20px"}
$$
z_\text{crit} = z_{(1-\frac{\alpha}{2})}
$$
:::

:::
::: {.column width="40%"}
![](images/ci_zcrit.png)
:::
::::


- Zu jedem **Konfidenzniveau** $1-\alpha$ lässt sich also ein [**kritischer z-Wert**]{color="navy"} $\color{navy}{z_{(1-\frac{\alpha}{2})}}$ zuordnen.
- Damit haben wir folgende aktualisierte (und vorerst finale) Formel des Konfidenzintervalls:

::: {.colorbox .fragment style="margin-top: -7px"}
$$
\text{Konfidenzintervall:}\qquad CI=\hat{\theta}\pm z_{(1-\frac{\alpha}{2})}\cdot se
$$
:::


- Der kritische z-Wert wird wie bisher auf Basis der Verteilungsfunktion $\Phi$ der Standardnormalverteilung berechnet (&rarr; z-Tabelle!):

:::{.fragment style="margin-top: -20px"}
$$
z_{(1-\frac{\alpha}{2})} = \Phi\left(1-\frac{\alpha}{2}\right)
$$
:::


<!----------------->
<!--- New slide --->
<!----------------->
## Konfidenzintervall: what it is and what it isn't
<!-- https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4877414/ -->

<div class="vspace-medium"></div>

<!---  Table --->
|||
|-|:-:|
| Schließt 95% der Fläche unter der Stichprobenverteilung ein.| ![](images/green_checkmark.png){height=50px}|
| Definiert einen Bereich möglicher Populationsparameter $\theta$, die nicht signifikant verschieden von der Punktschätzung $\hat{\theta}$ sind (bei einem 5%-Signifikanzniveau). |![](images/green_checkmark.png){height=50px}|
| Entspricht einem "Kompatibilitätsbereich" &mdash; Populationswerte innerhalb des Intervalls sind kompatibel mit dem Stichprobenkennwert. |![](images/green_checkmark.png){height=50px}|
| Auf lange Sicht werden 95% der erhobenen Stichproben ein Konfidenzintervall aufweisen, das den Populationsparameter einschließt. | ![](images/green_checkmark.png){height=50px}|

: **[Korrekte]{.underline} Aussagen zu einem 95%-Konfidenzintervall** {tbl-colwidths="[65, 10]"}

<div class="vspace-large"></div>

<!---  Table --->
|||
|-|:-:|
| Enthält den Populationsparameter mit einer Wahrscheinlichkeit von 95%.| ![](images/red_cross.png){height=50px}|
| Enthält 95% der Datenpunkte der vorliegenden Stichprobe. | ![](images/red_cross.png){height=50px}|
| Schließt erwartbar 95% der zukünftigen Stichprobeneffekte ein. | ![](images/red_cross.png){height=50px}|

: **[Falsche]{.underline} Aussagen zu einem 95%-Konfidenzintervall** {tbl-colwidths="[65, 10]"}



<!----------------->
<!--- New slide --->
<!----------------->
## [&plusmn;Standardfehler &wedgeq; Konfidenzintervall mit 68%-Konfidenzniveau]{style="font-size: 41px"}

Konfidenzintervall.. umfasst einen gewissen Prozentsatz der Stichprobenverteilung &mdash; does that ring a bell?

:::: {.columns}
::: {.column width="55%"}
- Auch der **Standardfehler** &mdash; als Streuungsmaß der Stichprobenverteilung &mdash; umfasst einen gewissen Bereich dieser Verteilung.
  - Reminder: Standardfehler = Standardabweichung der Stichprobenverteilung
- Der **Bereich [Kennwert $\hat{\theta}$ &plusmn; Standardfehler]** umfasst gemäß der *68-95-99.7-Regel* ungefähr 68% der Stichprobenverteilung und entspricht damit einem recht laxen **Konfidenzintervall mit einem Konfidenzniveau von 68%**.

:::
::: {.column width="45%"}
![](images/68_95_99.png)
:::
::::
